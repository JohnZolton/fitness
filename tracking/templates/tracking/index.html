{% extends "tracking/layout.html" %}

<div>
    {% block body %}
    {% if not bodyweight %}
    <form action = "{% url 'bodyweight' %}" method="post">
        {% csrf_token %}
        <label>Bodyweight: </label>
        <input type="number" step=".1" name="weight">
        <button type="submit">Save</button>
    </form>
    {% else %}
    <div>Body weight: {{bodyweight}}</div>
    {% endif %}
    
    <form action = "{% url 'steps' %}" method="get">
        <button type="submit">Sync Steps</button>
    </form>

    {% if meals %}
    <h2>Meal History</h2>
    <div>
        <table>
            <tr>
                <th>Item</th>
                <th>Protein</th>
                <th>Carb</th>
                <th>Fat</th>
                <th>Fiber</th>
                <th>Calories</th>
                <th>Serving (g)</th>
            </tr>
            {% for meal in meals %}
            <tr>
                {% for item in meal %}
                <td class="saved-meal">{{item}}</td>
                {% endfor %}
                <td>
                    <button id="{{meal.0}}-edit-item" class="edit-saved-meal">edit</button>
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td><strong>Totals: </strong></td>
                <td>{{protein}}/{{user.protein_goal}}</td>
                <td>{{carbs}}/{{user.carb_goal}}</td>
                <td>{{fats}}/{{user.fat_goal}}</td>
                <td></td>
                <td>{{calories}}/{{user.calorie_goal}}</td>
            </tr>
        </table>

    </div>
    {% endif %}
    <H2>Selected Foods</H2>
    <div id="meal-table-div" hidden>
        <form action="{% url 'savemeal' %}" method="post">
            {% csrf_token %}
        <table id="meal-table">
            <tr>
                <th>Item</th>
                <th>Protein</th>
                <th>Carb</th>
                <th>Fat</th>
                <th>Fiber</th>
                <th>Calories</th>
                <th>Amount (g)</th>
            </tr>
            
        </table>
        <button type="submit" id="save-meal">Save Meal</button>
        </form>
    </div>

    <h2>Search Foods</h2>
    <div id="searchbox">
        <form autocomplete="off" onSubmit='return false' action="{% url 'index' %}" method="POST" id="lookup">
            {% csrf_token %}
            <div class="autocomplete">
                <input type="text" name="food" id="food" placeholder="Food">
                <input type="hidden" value="lookup" name="formtype" >
            </div>
            <button id="submit">Search</button>
        </form>
    </div>
    <div>
        <table id="display-table">
        </table>
    </div>
    <input type="hidden" id="key" value="{{key}}">
    {% load static %}
<script type = 'text/javascript' src="{% static 'tracking.js' %}"></script>
    {% endblock %}
</div>